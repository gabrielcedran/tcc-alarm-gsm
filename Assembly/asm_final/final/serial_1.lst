MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;CÓDIGO BASE
                      00002 ;PIC16F628A
                      00003 ;OSCILADOR INTERNO 4MHZ
                      00004 ;PROF. IVAIR TEIXERA
                      00005 
                      00006 ; ******************************************************************************
                      00007 ;                         CONFIGURAÇÃO DO MICROCONTROLADOR.
                      00008 ; ******************************************************************************
                      00009     LIST                P=16F628A                 ;INFORMA O PIC UTILIZADO. 
                      00010     INCLUDE     <P16F628A.INC>            ;INCLUSÃO DA BIBLIOTECA.
                      00001         LIST
                      00002 ; P16F628A.INC  Standard Header File, Version 1.10    Microchip Technology, Inc.
                      00265         LIST
                      00266 
2007   3F18           00011     __CONFIG    _CP_OFF & _WDT_OFF & _PWRTE_OFF & _BODEN_OFF & _MCLRE_OFF   &   _INTRC_OSC_NOCLKOUT   & 
                              _LVP_OFF 
                      00012                 ;ATENÇÃO O CONFIG TEM QUE SER EM UMA ÚNICA LINHA.
                      00013     ERRORLEVEL  -302                      ;RETIRA MSG OPERAÇÃO NO BANCO 1.
                      00014 
                      00015 ; ******************************************************************************
                      00016 ;                          DECLARAÇÃO DE VARIÁVEIS E CONSTANTES.
                      00017 ; ******************************************************************************
                      00018     
                      00019     CBLOCK 0X20                         ;0X20 É O INÍCIO DA MEMÓRIA RAM
  00000020            00020         T1                                      ;T1 NO ENDEREÇO 0X20
  00000021            00021                 T2
  00000022            00022         AUX                     
  00000023            00023                 DADO        
                      00024     ENDC
Warning[207]: Found label after column 1. (V1)
  00000025            00025                 V1 EQU 0X25
Warning[207]: Found label after column 1. (V2)
  00000026            00026                 V2 EQU 0X26
Warning[207]: Found label after column 1. (V3)
  00000027            00027                 V3 EQU 0X27
                      00028         #DEFINE S_IGNICAO       PORTB,3         ;
                      00029         #DEFINE S_PORTA         PORTB,4         ;
                      00030         #DEFINE S_SIRENE        PORTB,5         ;
                      00031         #DEFINE S_FAROIS        PORTB,6         ;
                      00032 
                      00033 ; ******************************************************************************
                      00034 ;                          VETORES DE RESET E INTERRUPÇÃO.
                      00035 ; ******************************************************************************
                      00036 
0000                  00037     ORG 0X00                                    ;A EXECUÇÃO INICIA NESSE ENDEREÇO.
0000   2888           00038     GOTO           INICIO                   ;VAI PARA A SUB-ROTINA INÍCIO. 
                      00039         
0004                  00040     ORG 0X04                            ;VEM NESSE ENDEREÇO COM A INTERRUPÇÃO.
0004   0009           00041     RETFIE                                  ;RETORNA DA INTERRUPÇÃO.
                      00042 
                      00043 ; ******************************************************************************
                      00044 ;                                 ROTINAS GERAIS.
                      00045 ; ******************************************************************************
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0005                  00046 INICIALIZA
0005   3025           00047         MOVLW 0X25
0006   0084           00048         MOVWF FSR
0007   1186           00049         BCF S_IGNICAO
0008   1606           00050         BSF S_PORTA
0009   1286           00051         BCF S_SIRENE
000A   1306           00052         BCF S_FAROIS
000B   280C           00053         GOTO PRINCIPAL
                      00054 
000C                  00055 PRINCIPAL
000C   1E8C           00056         BTFSS   PIR1,RCIF
000D   280C           00057         GOTO    $-1
000E   2013           00058         CALL    RX_SERIAL
000F   2018           00059         CALL    TX_SERIAL
0010   201D           00060         CALL    CONVERTE
                      00061 ;       CALL    SALVA
0011   285B           00062         GOTO    DECODIFICA
0012   280C           00063         GOTO    PRINCIPAL
                      00064 
0013                  00065 RX_SERIAL
0013   081A           00066         MOVF    RCREG,W
0014   00A3           00067         MOVWF   DADO
0015   0823           00068         MOVF    DADO,W
0016   00A2           00069         MOVWF   AUX
0017   0008           00070         RETURN
                      00071 
0018                  00072 TX_SERIAL
0018   0822           00073         MOVF    AUX,W
0019   0099           00074         MOVWF   TXREG
001A   1E0C           00075         BTFSS   PIR1,TXIF
001B   281A           00076         GOTO    $-1
001C   0008           00077         RETURN
                      00078 
                      00079 
001D                  00080 CONVERTE
001D   3030           00081         MOVLW   .48
001E   02A2           00082         SUBWF   AUX,F   
001F   0008           00083         RETURN
                      00084 
0020                  00085 SALVA
0020   3025           00086         MOVLW   0X25
0021   0084           00087         MOVWF   FSR
0022   0822           00088         MOVF    AUX,W
0023   0080           00089         MOVWF   INDF
Message[305]: Using default destination of 1 (file).
0024   0A84           00090         INCF    FSR
0025   0008           00091         RETURN
                      00092 
0026                  00093 ATIVA_ALARME
0026   1186           00094         BCF  S_IGNICAO
0027   1706           00095         BSF  S_FAROIS
0028   1686           00096         BSF  S_SIRENE
0029   1606           00097         BSF      S_PORTA
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002A   207F           00098         CALL TEMPO
002B   207F           00099         CALL TEMPO
002C   207F           00100         CALL TEMPO
002D   207F           00101         CALL TEMPO
002E   1306           00102         BCF  S_FAROIS
002F   1286           00103         BCF  S_SIRENE
0030   207F           00104         CALL TEMPO
0031   207F           00105         CALL TEMPO
0032   207F           00106         CALL TEMPO
0033   207F           00107         CALL TEMPO
0034   1E8C           00108         BTFSS PIR1, RCIF ;testa se chegou caractere
0035   2826           00109         GOTO ATIVA_ALARME
0036   2013           00110         CALL    RX_SERIAL
0037   2018           00111         CALL    TX_SERIAL
0038   201D           00112         CALL    CONVERTE
0039   2867           00113         GOTO DECODIFICA_ALARME
                      00114 
003A                  00115 DESATIVA_ALARME
003A   1586           00116         BSF  S_IGNICAO
003B   1306           00117         BCF  S_FAROIS
003C   1286           00118         BCF  S_SIRENE
003D   1206           00119         BCF      S_PORTA
003E   280C           00120         GOTO PRINCIPAL
                      00121 
003F                  00122 ATIVA_LOCALIZADOR
003F   1706           00123         BSF      S_FAROIS
0040   207F           00124         CALL TEMPO
0041   207F           00125         CALL TEMPO
0042   207F           00126         CALL TEMPO
0043   207F           00127         CALL TEMPO
0044   1306           00128         BCF  S_FAROIS
0045   207F           00129         CALL TEMPO
0046   207F           00130         CALL TEMPO
0047   207F           00131         CALL TEMPO
0048   207F           00132         CALL TEMPO
0049   1E8C           00133         BTFSS PIR1, RCIF ;testa se chegou caractere
004A   283F           00134         GOTO ATIVA_LOCALIZADOR
004B   2013           00135         CALL    RX_SERIAL
004C   2018           00136         CALL    TX_SERIAL
004D   201D           00137         CALL    CONVERTE
004E   2873           00138         GOTO DECODIFICA_LOCALIZADOR
                      00139 
004F                  00140 DESATIVA_LOCALIZADOR
004F   1306           00141         BCF  S_FAROIS
0050   280C           00142         GOTO PRINCIPAL
                      00143 
                      00144 
0051                  00145 TRAVA_PORTAS
0051   1186           00146         BCF  S_IGNICAO
0052   1306           00147         BCF  S_FAROIS
0053   1286           00148         BCF  S_SIRENE
0054   1606           00149         BSF      S_PORTA
0055   280C           00150         GOTO PRINCIPAL
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00151 
0056                  00152 DESTRAVA_PORTAS
0056   1586           00153         BSF  S_IGNICAO
0057   1306           00154         BCF  S_FAROIS
0058   1286           00155         BCF  S_SIRENE
0059   1206           00156         BCF      S_PORTA
005A   280C           00157         GOTO PRINCIPAL
                      00158 
005B                  00159 DECODIFICA
                      00160         ; 1-Ativar o alarme; 2-localizador; 3-travar portas; 5-obter posição atual; 6 - cancelar localiz
                            ador 7-destravar portas;  9-desativar alarme
005B   0822           00161         MOVF    AUX,W
005C   0782           00162         ADDWF   PCL,F
005D   280C           00163         GOTO    PRINCIPAL                               ;'0'
005E   2826           00164         GOTO    ATIVA_ALARME                            ;'1'
005F   283F           00165         GOTO    ATIVA_LOCALIZADOR               ;'2'
0060   2851           00166         GOTO    TRAVA_PORTAS                    ;'3'
0061   280C           00167         GOTO    PRINCIPAL                               ;'4'
0062   280C           00168         GOTO    PRINCIPAL                       ;'5'
0063   284F           00169         GOTO    DESATIVA_LOCALIZADOR    ;'6'
0064   2856           00170         GOTO    DESTRAVA_PORTAS                 ;'7'
0065   280C           00171         GOTO    PRINCIPAL                               ;'8'
0066   283A           00172         GOTO    DESATIVA_ALARME                 ;'9'
                      00173 
0067                  00174 DECODIFICA_ALARME
                      00175         ; 1-Ativar o alarme; 2-localizador; 3-travar portas; 5-obter posição atual; 6 - cancelar localiz
                            ador 7-destravar portas;  9-desativar alarme
0067   0822           00176         MOVF    AUX,W
0068   0782           00177         ADDWF   PCL,F
0069   2826           00178         GOTO    ATIVA_ALARME                            ;'0'
006A   2826           00179         GOTO    ATIVA_ALARME                            ;'1'
006B   2826           00180         GOTO    ATIVA_ALARME            ;'2'
006C   2826           00181         GOTO    ATIVA_ALARME                    ;'3'
006D   2826           00182         GOTO    ATIVA_ALARME                            ;'4'
006E   2826           00183         GOTO    ATIVA_ALARME    ;'5'
006F   2826           00184         GOTO    ATIVA_ALARME    ;'6'
0070   2826           00185         GOTO    ATIVA_ALARME            ;'7'
0071   2826           00186         GOTO    ATIVA_ALARME                            ;'8'
0072   283A           00187         GOTO    DESATIVA_ALARME         ;'9'    
                      00188 
0073                  00189 DECODIFICA_LOCALIZADOR
                      00190         ; 1-Ativar o alarme; 2-localizador; 3-travar portas; 5-obter posição atual; 6 - cancelar localiz
                            ador 7-destravar portas;  9-desativar alarme
0073   0822           00191         MOVF    AUX,W
0074   0782           00192         ADDWF   PCL,F
0075   283F           00193         GOTO    ATIVA_LOCALIZADOR                               ;'0'
0076   2826           00194         GOTO    ATIVA_ALARME                            ;'1'
0077   283F           00195         GOTO    ATIVA_LOCALIZADOR               ;'2'
0078   2851           00196         GOTO    TRAVA_PORTAS                    ;'3'
0079   283F           00197         GOTO    ATIVA_LOCALIZADOR                               ;'4'
007A   283F           00198         GOTO    ATIVA_LOCALIZADOR       ;'5'
007B   284F           00199         GOTO    DESATIVA_LOCALIZADOR    ;'6'
007C   2856           00200         GOTO    DESTRAVA_PORTAS                 ;'7'
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

007D   283F           00201         GOTO    ATIVA_LOCALIZADOR                               ;'8'
007E   283A           00202         GOTO    DESATIVA_ALARME         ;'9'
                      00203 
                      00204 ; ******************************************************************************
                      00205 ;                                 ROTINAS DE TEMPORIZAÇÃO.
                      00206 ; ******************************************************************************
                      00207 
007F                  00208 TEMPO                               ;TEMPO DE 196MS
007F   30FF           00209     MOVLW       .255
0080   00A1           00210     MOVWF       T2                                  ;INICIALIZA T2 COM 255
0081   30FF           00211     MOVLW       .255
0082   00A0           00212     MOVWF       T1                      ;INICIALIZA T1 COM 255
0083   0BA0           00213     DECFSZ      T1, F                           ;DECREMENTA T1 E SALTA SE T1 = 0
0084   2883           00214     GOTO        $-1                                 ;VOLTA UMA LINHA
0085   0BA1           00215     DECFSZ      T2, F
0086   2881           00216     GOTO        $-5
0087   0008           00217     RETURN                                          ;RETORNA DA CHAMADA CALL
                      00218 
                      00219 ; ******************************************************************************
                      00220 ;                               CONFIGURAÇÃO INICIAL.
                      00221 ; ******************************************************************************
0088                  00222 INICIO
0088   1683           00223         BSF STATUS,RP0 ;MUDA PARA O BANCO 1
0089   0185           00224         CLRF PORTA ;PORTA TODO SAÍDA
008A   3002           00225         MOVLW B'00000010'
008B   0086           00226         MOVWF TRISB ;PORTB,1 ENTRADA, RESTANTE SAÍDA
008C   1698           00227         BSF TXSTA, TXEN ;HABILITA A TRANSMISSÃO SERIAL
008D   1498           00228         BSF TXSTA, TRMT ;LIMPA O REGISTRADOR DE TRANSMISSÃO
008E   1518           00229         BSF TXSTA, BRGH ;MODO ALTA VELOCIDADE
008F   3019           00230         MOVLW .25 ;BAUD RATE PARA 9.600 BPS
0090   0099           00231         MOVWF SPBRG ;
0091   1283           00232         BCF STATUS,RP0 ;VOLTA PARA O BANCO 0
0092   3007           00233         MOVLW B'00000111' ;DESABILITA OS...
0093   009F           00234         MOVWF CMCON ;... COMPARADORES ANALÓGICOS
0094   1798           00235         BSF RCSTA,SPEN ;HABILITA A COMUNICAÇÃO SERIAL
0095   1618           00236         BSF RCSTA,CREN ;HABILITA A RECEPÇÃO CONTÍNUA
0096   0185           00237         CLRF    PORTA                       ;INICIALIZA PORTA COM 0
0097   0186           00238     CLRF    PORTB                               
0098   2805           00239     GOTO    INICIALIZA                          ;VAI PARA A ROTINA PRINCIPAL    
                      00240     END
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  6


SYMBOL TABLE
  LABEL                             VALUE 

ADEN                              00000003
ATIVA_ALARME                      00000026
ATIVA_LOCALIZADOR                 0000003F
AUX                               00000022
BRGH                              00000002
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1H                            00000016
CCPR1L                            00000015
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000001F
CMIE                              00000006
CMIF                              00000006
CONVERTE                          0000001D
CREN                              00000004
CSRC                              00000007
DADO                              00000023
DC                                00000001
DECODIFICA                        0000005B
DECODIFICA_ALARME                 00000067
DECODIFICA_LOCALIZADOR            00000073
DESATIVA_ALARME                   0000003A
DESATIVA_LOCALIZADOR              0000004F
DESTRAVA_PORTAS                   00000056
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
F                                 00000001
FERR                              00000002
FSR                               00000004
GIE                               00000007
INDF                              00000000
INICIALIZA                        00000005
INICIO                            00000088
INTCON                            0000000B
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  7


SYMBOL TABLE
  LABEL                             VALUE 

INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
NOT_BO                            00000000
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
OERR                              00000001
OPTION_REG                        00000081
OSCF                              00000003
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTB                             00000006
PR2                               00000092
PRINCIPAL                         0000000C
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RBIE                              00000003
RBIF                              00000000
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RP0                               00000005
RP1                               00000006
RX9                               00000006
RX9D                              00000000
RX_SERIAL                         00000013
SALVA                             00000020
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
STATUS                            00000003
SYNC                              00000004
S_FAROIS                          PORTB,6
S_IGNICAO                         PORTB,3
S_PORTA                           PORTB,4
S_SIRENE                          PORTB,5
T0CS                              00000005
T0IE                              00000005
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  8


SYMBOL TABLE
  LABEL                             VALUE 

T0IF                              00000002
T0SE                              00000004
T1                                00000020
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1OSCEN                           00000003
T2                                00000021
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TEMPO                             0000007F
TMR0                              00000001
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRAVA_PORTAS                      00000051
TRISA                             00000085
TRISB                             00000086
TRMT                              00000001
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
TX_SERIAL                         00000018
V1                                00000025
V2                                00000026
V3                                00000027
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009F
VREN                              00000007
VROE                              00000006
VRR                               00000005
W                                 00000000
WR                                00000001
WREN                              00000002
MPASM  5.30                      SERIAL_1.ASM   12-1-2011  20:20:06         PAGE  9


SYMBOL TABLE
  LABEL                             VALUE 

WRERR                             00000003
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DATA_CP_OFF                      00003FFF
_DATA_CP_ON                       00003EFF
_ER_OSC_CLKOUT                    00003FFF
_ER_OSC_NOCLKOUT                  00003FFE
_EXTCLK_OSC                       00003FEF
_HS_OSC                           00003FEE
_INTOSC_OSC_CLKOUT                00003FFD
_INTOSC_OSC_NOCLKOUT              00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC_CLKOUT                    00003FFF
_RC_OSC_NOCLKOUT                  00003FFE
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_XT_OSC                           00003FED
__16F628A                         00000001
__DEBUG                           1


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXX------- ---------------- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   150
Program Memory Words Free:  1898


Errors   :     0
Warnings :     3 reported,     0 suppressed
Messages :     1 reported,     5 suppressed

